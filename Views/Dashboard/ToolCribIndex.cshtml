@model PlusCP.Models.DashboardModel
@{
    ViewBag.Title = "Tool Crib Dashboard Index";
    Layout = null;
}

<link rel="stylesheet" type="text/css" href="~/Content/css/jquery.gridster.css" />
    <script type="text/javascript" src="~/Scripts/jquery.gridster.js"></script>
<link href="~/Content/css/message.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style type="text/css">

    /* Card base styling */
    /* Stats Cards */
    .stats-card {
        padding: 25px;
        border-radius: 14px;
        border: 1px solid #e0e0e0;
        background: #fff;
        text-align: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stats-card i {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .stats-card h5 {
            font-size: 18px;
            color: #555;
            margin-bottom: 8px;
        }

        .stats-card h2 {
            font-size: 34px;
            font-weight: bold;
            color: #2c3e50;
        }

    /* Chart Cards */
    .chart-card {
        padding: 18px;
        border: 1px solid #e0e0e0;
        border-radius: 14px;
        background: #fff;
        min-height: 320px;
        transition: box-shadow 0.2s;
    }

        .chart-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .chart-card h4 {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin-bottom: 12px;
        }

    /* Smaller width */
    .small-card {
        min-width: 200px;
        max-width: 230px;
        margin: auto;
    }

    /* Gap between cards */
    .row > div {
        padding-left: 10px;
        padding-right: 10px;
    }

    /* Hover effect */
    .stat-card:hover {
        transform: translateY(-5px);
    }

    .stat-icon {
        font-size: 28px;
        color: #fff;
        padding: 15px;
        border-radius: 12px;
        margin-right: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Specific colors */
    .icon-blue {
        background-color: #007bff; /* Blue */
    }

    .icon-green {
        background-color: #28a745; /* Green */
    }

    .icon-darkyellow {
        background-color: #e69500; /* Dark yellow/orange */
    }


    /* Text style */
    .stat-info h5 {
        margin: 0;
        font-size: 13px;
        color: #fff;
    }

    .stat-info h2 {
        margin: 0;
        font-size: 20px;
        font-weight: bold;
    }

    /* Row ke andar spacing */
    .row {
        margin-left: 0;
        margin-right: 0;
    }

        /* Cards ke beech aur row ke andar gap */
        .row > div {
            padding: 10px; /* ye har card ke around space dega */
        }

    .Header {
        font-weight: bold;
    }
</style>
<div class="panel panel-default" style="border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1); border:none;">
    <div class="panel-body text-center" style="padding: 25px; background: linear-gradient(to top, white, #D6EFE8); border-radius: 12px; ">

        <h3 style="margin:0; color:#2c3e50; font-weight:600; font-family: 'Segoe UI', Tahoma, sans-serif;">
            <i class="fa-solid fa-user-circle me-2 text-success" style="font-size:28px;"></i>
            <span style="font-size:22px;">Welcome, <span style="color:#007b83;">@Session["Username"]</span>!</span>
        </h3>

        <p style="margin-top:5px; font-size:15px; color:#666; font-style:italic; font-weight:bold;">
            (ID: @Session["SigninId"])
        </p>

        <h4 style="margin-top:12px; font-family:'Segoe UI',Tahoma,sans-serif; font-weight:500; color:#2c3e50;">
            <span style="color:#16a085; font-size:22px; font-weight:600;">Tool Crib</span>
            <span style="color:#bbb; font-size:20px; font-weight:600;">|</span>
            <span style="color:#16a085; font-size:20px; font-weight:600;">Portal</span>
        </h4>
    </div>
</div>


<div class="container-fluid">
    <!-- Stats Row -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="stats-card">
                <i class="fas fa-toolbox text-primary"></i>
                <h5>Total Tools</h5>
                <h2 id="totalTools">0</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <i class="fas fa-check-circle text-success"></i>
                <h5>Available</h5>
                <h2 id="availableTools">0</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <i class="fas fa-briefcase text-warning"></i>
                <h5>Checked Out</h5>
                <h2 id="checkedOutTools">0</h2>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4">
        <div class="col-md-4">
            <div class="chart-card">
                <h4>Tools Distribution</h4>
                <canvas id="donutChart" height="150"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-card">
                <h4>Top 3 Usage Tools</h4>
                <canvas id="topToolsChart" height="150"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-card">
                <h4>Checked Out Tools (Weekly)</h4>
                <canvas id="barChart" height="150"></canvas>
            </div>
        </div>
    </div>
</div>








<script>
    $(document).ready(function () {
        $.ajax({
            url: '/Tool/GetWidgetCounts',
            type: 'GET',
            success: function (data) {
                // Stats numbers update
                $("#totalTools").text(data.TotalTools);
                $("#availableTools").text(data.Available);
                $("#checkedOutTools").text(data.CheckedOut);

                // Donut chart update with API values
                new Chart(document.getElementById('donutChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Available', 'Checked Out'],
                        datasets: [{
                            data: [data.Available, data.CheckedOut],
                            backgroundColor: ['#28a745', '#007bff'],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { display: false },   // Legend hide
                            tooltip: { enabled: false },  // Tooltip hide
                            datalabels: { display: false } // ✅ Center/data labels hide
                        }
                    },
                    plugins: [] // agar kahin aur datalabel plugin auto load ho raha hai to disable
                });


            },
            error: function () {
                alert("Error loading stats!");
            }
        });


        $.ajax({
            url: '/Tool/GetTopUsedTool',
            type: 'GET',
            success: function (data) {
                let labels = [];
                let values = [];

                $.each(data, function (i, item) {
                    labels.push(item.ToolName);
                    values.push(item.UsageCount);
                });

                // Horizontal Bar Chart
                new Chart(document.getElementById('topToolsChart'), {
                    type: 'horizontalBar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Usage Count',
                            data: values,
                            backgroundColor: '#444444',
                            barThickness: 35 // ✅ bar ki width (pixels me) control
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            datalabels: { display: false },
                        },
                        tooltips: { enabled: false },
                        legend: { display: false },
                        scales: {
                            xAxes: [{
                                ticks: { beginAtZero: true },
                                gridLines: { display: false }  // ✅ X-axis ki lines hide
                            }],
                            yAxes: [{
                                barPercentage: 0.6,        // ✅ category space control
                                categoryPercentage: 0.6,    // ✅ aur slim karega
                                gridLines: { display: false }  // ✅ X-axis ki lines hide
                            }]
                        }
                    }
                });






            },
            error: function () {
                alert("Error loading Top Used Tools!");
            }
        });


        $.ajax({
            url: '/Tool/GetCheckedOutWeekly', // 👈 aapka controller method
            type: 'GET',
            success: function (data) {
                // Agar aap sirf WeekNumber bhej rahe ho
                const labels = data.map(x => "Week " + x.WeekNumber);
                const values = data.map(x => x.CheckedOutCount);

                new Chart(document.getElementById('barChart'), {
                    type: 'bar',   // 👈 'line' likha hai abhi, bar chart chahiye to 'bar' use karein
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Checked Out',
                            data: values,
                            backgroundColor: '#007bff',
                            barThickness: 25 // ✅ bar ki width (pixels me) control
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            datalabels: { display: false },
                        },
                        tooltips: { enabled: true }, // ✅ tooltips enable karna zyada useful hai
                        legend: { display: false },
                        scales: {
                            xAxes: [{
                                barPercentage: 0.3,
                                categoryPercentage: 0.3,
                                gridLines: { display: false }   // ✅ X-axis grid off
                            }],
                            yAxes: [{
                                ticks: { beginAtZero: true },
                                gridLines: { display: false }   // ✅ Y-axis grid off
                            }]
                        }

                    }
                });
            },
            error: function () {
                alert("Error loading Checked Out Weekly Stats!");
            }
        });







    });






</script>




