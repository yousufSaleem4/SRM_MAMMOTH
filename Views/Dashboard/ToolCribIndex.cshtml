@model PlusCP.Models.DashboardModel
@{
    ViewBag.Title = "Tool Crib Dashboard Index";
    Layout = null;
}

<link rel="stylesheet" type="text/css" href="~/Content/css/jquery.gridster.css" />
<script type="text/javascript" src="~/Scripts/jquery.gridster.js"></script>
<link href="~/Content/css/message.css" rel="stylesheet" />
<style type="text/css">

    /* Card base styling */
    .stat-card {
        display: flex;
        align-items: center;
        padding: 12px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s;
        justify-content: flex-start;
    }

    /* Smaller width */
    .small-card {
        min-width: 200px;
        max-width: 230px;
        margin: auto;
    }

    /* Gap between cards */
    .row > div {
        padding-left: 10px;
        padding-right: 10px;
    }

    /* Hover effect */
    .stat-card:hover {
        transform: translateY(-5px);
    }

    .stat-icon {
        font-size: 28px;
        color: #fff;
        padding: 15px;
        border-radius: 12px;
        margin-right: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Specific colors */
    .icon-blue {
        background-color: #007bff; /* Blue */
    }

    .icon-green {
        background-color: #28a745; /* Green */
    }

    .icon-darkyellow {
        background-color: #e69500; /* Dark yellow/orange */
    }


    /* Text style */
    .stat-info h5 {
        margin: 0;
        font-size: 13px;
        color: #fff;
    }

    .stat-info h2 {
        margin: 0;
        font-size: 20px;
        font-weight: bold;
    }

    /* Row ke andar spacing */
    .row {
        margin-left: 0;
        margin-right: 0;
    }

        /* Cards ke beech aur row ke andar gap */
        .row > div {
            padding: 10px; /* ye har card ke around space dega */
        }

    .Header {
        font-weight: bold;
    }



</style>
<div class="panel panel-default" style="border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.1); border: none;">
    <div class="panel-body text-center" style="padding:25px; background: linear-gradient(135deg, #d4edda, #c3e6cb); border-radius:12px;">
        <h3 style="margin:0; color:#003B59; font-weight:bold;">
            Welcome, @Session["Username"]! <br />
            <span style="font-size:16px; color:#555;">(ID: @Session["SigninId"])</span>
        </h3>
        <h4 style="margin-top:10px; color:#003B59; font-weight:bold;">
            Tool Crib <span style="color: #2AAA82; font-size: 25px; font-weight: bold">|</span>
            <span style="color: #2AAA82; font-size: 20px; font-weight: bold">Portal</span>
        </h4>
    </div>
</div>

<div class="container-fluid" >
    <!-- White Card Container -->
    <div class="card shadow-lg p-4" style="border-radius: 16px; background: #fff; ">

        <!-- Stats Row -->
        <div class="row g-4 mb-5 pt-3">
            <!-- Total Tools -->
            <div class="col-md-4">
                <div class="p-4 border text-center" style="border:1px solid #e0e0e0; border-radius:14px;">
                    <i class="fas fa-toolbox fa-3x text-primary mb-3"></i>
                    <h5 style="font-size:19px; color:#555;">Total Tools</h5>
                    <h2 id="totalTools" class="fw-bold" style="font-size:36px;">0</h2>
                </div>
            </div>

            <!-- Available -->
            <div class="col-md-4">
                <div class="p-4 border text-center" style="border:1px solid #e0e0e0; border-radius:14px;">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h5 style="font-size:19px; color:#555;">Available</h5>
                    <h2 id="availableTools" class="fw-bold" style="font-size:36px;">0</h2>
                </div>
            </div>

            <!-- Checked Out -->
            <div class="col-md-4">
                <div class="p-4 border text-center" style="border:1px solid #e0e0e0; border-radius:14px;">
                    <i class="fas fa-briefcase fa-3x text-warning mb-3"></i>
                    <h5 style="font-size:19px; color:#555;">Checked Out</h5>
                    <h2 id="checkedOutTools" class="fw-bold" style="font-size:36px;">0</h2>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row g-4 pt-4">
            <div class="col-md-4">
                <div class="p-3 border h-100" style="border:1px solid #e0e0e0; border-radius:14px; min-height:320px;">
                    <h4 class="text-center mb-3 Header" style="font-size:19px;">Tools Distribution</h4>
                    <canvas id="donutChart" height="150"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="p-3 border h-100" style="border:1px solid #e0e0e0; border-radius:14px; min-height:320px;">
                    <h4 class="text-center mb-3 Header" style="font-size:19px;">Usage Tools</h4>
                    <canvas id="topToolsChart" height="150"></canvas>
                </div>
            </div>

            <div class="col-md-4">
                <div class="p-3 border h-100" style="border:1px solid #e0e0e0; border-radius:14px; min-height:320px;">
                    <h4 class="text-center mb-3 Header" style="font-size:19px;">Checked Out Tools (Monthly)</h4>
                    <canvas id="barChart" height="150"></canvas>
                </div>
            </div>
        </div>

    </div>
</div>








<script>
    $(document).ready(function () {
        $.ajax({
            url: '/Tool/GetWidgetCounts',
            type: 'GET',
            success: function (data) {
                // Stats numbers update
                $("#totalTools").text(data.TotalTools);
                $("#availableTools").text(data.Available);
                $("#checkedOutTools").text(data.CheckedOut);

                // Donut chart update with API values
                new Chart(document.getElementById('donutChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Available', 'Checked Out'],
                        datasets: [{
                            data: [data.Available, data.CheckedOut],
                            backgroundColor: ['#28a745', '#007bff'],
                            borderColor: '#fff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { display: false },   // Legend hide
                            tooltip: { enabled: false },  // Tooltip hide
                            datalabels: { display: false } // ✅ Center/data labels hide
                        }
                    },
                    plugins: [] // agar kahin aur datalabel plugin auto load ho raha hai to disable
                });


            },
            error: function () {
                alert("Error loading stats!");
            }
        });


        $.ajax({
            url: '/Tool/GetTopUsedTool',
            type: 'GET',
            success: function (data) {
                let labels = [];
                let values = [];

                $.each(data, function (i, item) {
                    labels.push(item.ToolName);
                    values.push(item.UsageCount);
                });

                // Horizontal Bar Chart
                new Chart(document.getElementById('topToolsChart'), {
                    type: 'horizontalBar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Usage Count',
                            data: values,
                            backgroundColor: '#444444',
                            barThickness: 35 // ✅ bar ki width (pixels me) control
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            datalabels: { display: false },
                        },
                        tooltips: { enabled: false },
                        legend: { display: false },
                        scales: {
                            xAxes: [{ ticks: { beginAtZero: true } }],
                            yAxes: [{
                                barPercentage: 0.6,        // ✅ category space control
                                categoryPercentage: 0.6    // ✅ aur slim karega
                            }]
                        }
                    }
                });






            },
            error: function () {
                alert("Error loading Top Used Tools!");
            }
        });


        $.ajax({
            url: '/Tool/GetCheckedOutMonthly',
            type: 'GET',
            success: function (data) {
                const labels = data.map(x => x.MonthName);
                const values = data.map(x => x.CheckedOutCount);

                new Chart(document.getElementById('barChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Checked Out',
                            data: values,
                            backgroundColor: '#007bff',
                       barThickness: 25 // ✅ bar ki width (pixels me) control
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            datalabels: { display: false },
                        },
                        tooltips: { enabled: false },
                        legend: { display: false },
                        scales: {
                           // xAxes: [{ ticks: { beginAtZero: true } }],
                            xAxes: [{
                                barPercentage: 0.4,        // ✅ category space control
                                categoryPercentage: 0.4    // ✅ aur slim karega
                            }]
                        }
                    }
                });






            },
            error: function () {
                alert("Error loading Top Used Tools!");
            }
        });






    });






</script>




